<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Our Products | Spice Haven Exports</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="accessibility.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        .price-tag {
            background-color: var(--cream);
            color: var(--deep-green);
            font-weight: bold;
            padding: 0.5rem 1rem;
            border-radius: 50px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            margin-top: 1rem;
            border: 1px solid var(--gold);
            font-size: 1.1rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .price-tag .unit {
            font-size: 0.8em;
            color: var(--text-light);
            font-weight: normal;
        }
    </style>
</head>
<body class="snap-scroll"> <header style="position: fixed; width: 100%; top: 0; z-index: 1000;">
        <nav class="container">
            <a href="index.html" class="logo-container">
                <img src="logo.png" alt="Spice Haven Exports Logo" class="logo-img">
                <div class="logo-text"><h1 data-i18n="hero_title">Spice Haven Exports</h1><p data-i18n="hero_tagline">Pure Aroma. True Flavor.</p></div>
            </a>
            <button class="mobile-menu" onclick="toggleMenu()">☰</button>
            <ul id="nav-menu">
                <li><a href="index.html" data-i18n="nav_home">Home</a></li>
                <li><a href="about.html" data-i18n="nav_about">About</a></li>
                <li><a href="products.html" class="active" data-i18n="nav_products">Products</a></li>
                <li><a href="contact.html" data-i18n="nav_contact">Contact</a></li>
            </ul>
        </nav>
    </header>

    <div class="scroll-indicator">
        <!-- Dots will be generated by JavaScript -->
    </div>

    <div class="scroll-container" id="mainScroll">
        
        <section class="product-screen" style="background-image: url('https://images.unsplash.com/photo-1596040033229-a9821ebd058d?q=80&w=1920&auto=format&fit=crop');">
            <div class="glass-card visible"> <h2 data-i18n="products_hero_title">Our Signature Collection</h2>
                <span class="subtitle" data-i18n="products_hero_subtitle">Handpicked from the Hills of Idukki</span>
                <p data-i18n="products_hero_desc">We don't sell everything. We only sell what we can grow perfectly. Scroll down to experience the purity of Kerala's finest spices.</p>
                <div style="margin-top: 2rem;">
                    <a href="#all-products-container" class="cta-button" style="background: var(--deep-green); border-color: var(--deep-green);">View Full Catalog</a>
                </div>
            </div>
        </section>

        <section class="product-screen" id="product-pepper" style="background-image: url('images/black-pepper.jpg');">
            <div class="glass-card">
                <h2 data-i18n="pepper_page_title">Idukki Black Pepper</h2>
                <span class="subtitle" data-i18n="pepper_page_subtitle">Idukki Gold - King of Spices</span>
                <p data-i18n="pepper_page_desc">Bold, aromatic, and rich in piperine. Our pepper vines climb high on shade trees, allowing the berries to mature slowly and develop a complex, robust flavor profile.</p>
                <ul class="glass-features">
                    <li data-i18n="pepper_page_feature1">High Piperine Content</li>
                    <li data-i18n="pepper_page_feature2">Bold, Uniform Berries</li>
                    <li data-i18n="pepper_page_feature3">Sun-Dried Naturally</li>
                    <li data-i18n="pepper_page_feature4">Grade: TGSEB & MG-1</li>
                </ul>
                <a href="contact.html" class="cta-button" data-i18n="request_quote">Request Quote</a>
            </div>
        </section>

        <section class="product-screen" id="product-cardamom" style="background-image: url('images/cardamom.jpg');">
            <div class="glass-card">
                <h2 data-i18n="cardamom_page_title">Green Cardamom</h2>
                <span class="subtitle" data-i18n="cardamom_page_subtitle">Queen of Spices</span>
                <p data-i18n="cardamom_page_desc">Our cardamom is known for its vibrant green color and intense aroma. Harvested at the perfect moment of maturity to ensure the seeds inside are full of essential oils.</p>
                <ul class="glass-features">
                    <li data-i18n="cardamom_page_feature1">8mm+ Pod Size Available</li>
                    <li data-i18n="cardamom_page_feature2">Intense Aroma</li>
                    <li data-i18n="cardamom_page_feature3">No Artificial Color</li>
                    <li data-i18n="cardamom_page_feature4">Hand-Sorted</li>
                </ul>
                <a href="contact.html" class="cta-button" data-i18n="request_quote">Request Quote</a>
            </div>
        </section>

        <section class="product-screen" id="product-coffee" style="background-image: url('images/coffee.jpg');">
            <div class="glass-card">
                <h2 data-i18n="coffee_page_title">High Range Coffee</h2>
                <span class="subtitle" data-i18n="coffee_page_subtitle">Robusta & Arabica Blend</span>
                <p data-i18n="coffee_page_desc">Grown in the shade of spice plantations, our coffee absorbs the essence of the surrounding flora. The result is a smooth, low-acidity cup with chocolatey undertones.</p>
                <ul class="glass-features">
                    <li data-i18n="coffee_page_feature1">Altitude: 3000ft+</li>
                    <li data-i18n="coffee_page_feature2">Shade Grown</li>
                    <li data-i18n="coffee_page_feature3">Selective Picking</li>
                    <li data-i18n="coffee_page_feature4">Wet & Dry Processing</li>
                </ul>
                <a href="contact.html" class="cta-button" data-i18n="request_quote">Request Quote</a>
            </div>
        </section>

        <section class="product-screen product-catalog-screen" id="all-products-container">
            <div class="catalog-card">
                <div class="page-header" style="margin-bottom: 2rem;">
                    <h2 class="page-title" data-i18n="full_catalog_title">Our Full Catalog</h2>
                </div>
                <div id="dynamic-product-grid" class="product-grid">
                    <p id="loading-message" data-i18n="loading_products">Loading our finest products...</p>
                </div>
            </div>
        </section>

    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/i18next/23.7.11/i18next.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/i18next-http-backend/2.4.2/i18nextHttpBackend.min.js"></script>

    <script src="script.js"></script>
    <script src="i18n.js"></script>
    <script src="accessibility.js"></script>

    <script>
        // --- COMBINED SCRIPT FOR PRODUCTS PAGE ---

        document.addEventListener('DOMContentLoaded', () => {
            // --- 1. DYNAMIC PRODUCT FETCHING ---
            const productGrid = document.getElementById('dynamic-product-grid');
            const loadingMessage = document.getElementById('loading-message');
            const apiUrl = '/.netlify/functions/get-products';

            fetch(apiUrl)
                .then(response => {
                    if (!response.ok) throw new Error(`Network response was not ok: ${response.statusText}`);
                    return response.json();
                })
                .then(products => {
                    if (loadingMessage) loadingMessage.style.display = 'none';
                    
                    if (products && products.length > 0) {
                        products.forEach(product => {
                            const name = product.name ? product.name.replace(/</g, "&lt;") : 'Unnamed Product';
                            const description = product.description ? product.description.replace(/</g, "&lt;") : 'No description available.';
                            const imageUrl = product.image_url || 'images/placeholder-story.jpg';
                            
                            const unitDisplay = product.unit ? `<span class="unit">/ ${product.unit}</span>` : '';
                            const priceHtml = product.price 
                                ? `<div class="price-tag">₹${product.price} ${unitDisplay}</div>` 
                                : '';

                            // 1. Add to Grid
                            const card = document.createElement('div');
                            card.className = 'product-card';
                            card.innerHTML = `
                                <div class="product-image"><img src="${imageUrl}" alt="${name}"></div>
                                <div class="product-info" style="display: flex; flex-direction: column; height: 100%;">
                                    <h3>${name}</h3>
                                    <p style="color: var(--text-light); font-size: 1rem; line-height: 1.5; flex-grow: 1;">${description}</p>
                                    ${priceHtml}
                                </div>`;
                            productGrid.appendChild(card);

                            // 2. Update Hero Sections if match found
                            // Helper to update CTA
                            const updateHeroPrice = (sectionId, price, unit) => {
                                const section = document.getElementById(sectionId);
                                if (section && price) {
                                    const cta = section.querySelector('.cta-button');
                                    if (cta) {
                                        cta.textContent = `Buy Now - ₹${price} / ${unit || 'kg'}`;
                                        cta.style.background = 'var(--deep-green)';
                                    }
                                }
                            };

                            if (name.toLowerCase().includes('black pepper') && name.toLowerCase().includes('idukki')) {
                                updateHeroPrice('product-pepper', product.price, product.unit);
                            } else if (name.toLowerCase().includes('green cardamom')) {
                                updateHeroPrice('product-cardamom', product.price, product.unit);
                            } else if (name.toLowerCase().includes('high range coffee')) {
                                updateHeroPrice('product-coffee', product.price, product.unit);
                            }
                        });
                    } else {
                        const noProductsEl = document.createElement('p');
                        noProductsEl.setAttribute('data-i18n', 'no_products_available');
                        noProductsEl.textContent = 'No products are currently available. Please check back later.';
                        productGrid.appendChild(noProductsEl);
                    }
                })
                .catch(error => {
                    console.error('Error fetching products:', error);
                    if(loadingMessage) loadingMessage.style.display = 'none';
                    const errorEl = document.createElement('p');
                    errorEl.setAttribute('data-i18n', 'error_loading_products');
                    errorEl.style.color = 'red';
                    errorEl.textContent = 'Sorry, we couldn\'t load our products at this time.';
                    productGrid.appendChild(errorEl);
                })
                .finally(() => {
                    // --- 2. SETUP SCROLL LOGIC (AFTER FETCH) ---
                    setupScrollFeatures();
                    // Re-run content update in case new elements were added
                    if (typeof updateContent === 'function') updateContent();
                });

            // --- 3. SCROLL FEATURES SETUP FUNCTION ---
            function setupScrollFeatures() {
                const sections = document.querySelectorAll('.product-screen');
                const scrollIndicator = document.querySelector('.scroll-indicator');
                
                scrollIndicator.innerHTML = '';
                sections.forEach((_, index) => {
                    const dot = document.createElement('div');
                    dot.className = 'dot';
                    dot.onclick = () => scrollToSection(index);
                    scrollIndicator.appendChild(dot);
                });

                const dots = document.querySelectorAll('.dot');
                if(dots.length > 0) dots[0].classList.add('active');
                
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const glassCard = entry.target.querySelector('.glass-card');
                            if(glassCard) glassCard.classList.add('visible');

                            const index = Array.from(sections).indexOf(entry.target);
                            dots.forEach(d => d.classList.remove('active'));
                            if (dots[index]) dots[index].classList.add('active');
                        }
                    });
                }, { threshold: 0.5 });

                sections.forEach(section => observer.observe(section));
            }
        });

        function scrollToSection(index) {
            const sections = document.querySelectorAll('.product-screen');
            if (sections[index]) {
                sections[index].scrollIntoView({ behavior: 'smooth' });
            }
        }
    </script>
</body>
</html>