<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Our Products | Spice Haven Exports</title>
    <link rel="stylesheet" href="style.css">
</head>
<body class="snap-scroll"> <header style="position: fixed; width: 100%; top: 0; z-index: 1000;">
        <nav class="container">
            <a href="index.html" class="logo-container">
                <img src="logo.png" alt="Spice Haven Exports Logo" class="logo-img">
                <div class="logo-text"><h1>Spice Haven Exports</h1><p>Pure Aroma. True Flavor.</p></div>
            </a>
            <button class="mobile-menu" onclick="toggleMenu()">☰</button>
            <ul id="nav-menu">
                <li><a href="index.html">Home</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="products.html" class="active">Products</a></li>
                <li><a href="contact.html">Contact</a></li>
            </ul>
        </nav>
    </header>

    <div class="scroll-indicator">
        <div class="dot active" onclick="scrollToSection(0)"></div>
        <div class="dot" onclick="scrollToSection(1)"></div>
        <div class="dot" onclick="scrollToSection(2)"></div>
        <div class="dot" onclick="scrollToSection(3)"></div>
    </div>

    <div class="scroll-container" id="mainScroll">
        
        <section class="product-screen" style="background-image: url('https://images.unsplash.com/photo-1596040033229-a9821ebd058d?q=80&w=1920&auto=format&fit=crop');">
            <div class="glass-card visible"> <h2>Our Signature Collection</h2>
                <span class="subtitle">Handpicked from the Hills of Idukki</span>
                <p>We don't sell everything. We only sell what we can grow perfectly. Scroll down to experience the purity of Kerala's finest spices.</p>
                <p style="font-size: 0.9rem; margin-top: 1rem;">⬇ Scroll to explore</p>
            </div>
        </section>

        <section class="product-screen" style="background-image: url('images/black-pepper.jpg');">
            <div class="glass-card">
                <h2>Idukki Black Pepper</h2>
                <span class="subtitle">Idukki Gold - King of Spices</span>
                <p>Bold, aromatic, and rich in piperine. Our pepper vines climb high on shade trees, allowing the berries to mature slowly and develop a complex, robust flavor profile.</p>
                <ul class="glass-features">
                    <li>High Piperine Content</li>
                    <li>Bold, Uniform Berries</li>
                    <li>Sun-Dried Naturally</li>
                    <li>Grade: TGSEB & MG-1</li>
                </ul>
                <a href="contact.html" class="cta-button">Request Quote</a>
            </div>
        </section>

        <section class="product-screen" style="background-image: url('images/cardamom.jpg');">
            <div class="glass-card">
                <h2>Green Cardamom</h2>
                <span class="subtitle">Queen of Spices</span>
                <p>Our cardamom is known for its vibrant green color and intense aroma. Harvested at the perfect moment of maturity to ensure the seeds inside are full of essential oils.</p>
                <ul class="glass-features">
                    <li>8mm+ Pod Size Available</li>
                    <li>Intense Aroma</li>
                    <li>No Artificial Color</li>
                    <li>Hand-Sorted</li>
                </ul>
                <a href="contact.html" class="cta-button">Request Quote</a>
            </div>
        </section>

        <section class="product-screen" style="background-image: url('images/coffee.jpg');">
            <div class="glass-card">
                <h2>High Range Coffee</h2>
                <span class="subtitle">Robusta & Arabica Blend</span>
                <p>Grown in the shade of spice plantations, our coffee absorbs the essence of the surrounding flora. The result is a smooth, low-acidity cup with chocolatey undertones.</p>
                <ul class="glass-features">
                    <li>Altitude: 3000ft+</li>
                    <li>Shade Grown</li>
                    <li>Selective Picking</li>
                    <li>Wet & Dry Processing</li>
                </ul>
                <a href="contact.html" class="cta-button">Request Quote</a>
            </div>
        </section>

        <section class="product-screen product-catalog-screen" id="all-products-container">
            <div class="catalog-card">
                <div class="page-header" style="margin-bottom: 2rem;">
                    <h2 class="page-title">Our Full Catalog</h2>
                </div>
                <div id="dynamic-product-grid" class="product-grid">
                    <p id="loading-message">Loading our finest products...</p>
                </div>
            </div>
        </section>

    </div>

    <script src="script.js"></script>
    <script>
        // --- COMBINED SCRIPT FOR PRODUCTS PAGE ---

        document.addEventListener('DOMContentLoaded', () => {
            // --- 1. DYNAMIC PRODUCT FETCHING ---
            const productGrid = document.getElementById('dynamic-product-grid');
            const loadingMessage = document.getElementById('loading-message');
            const apiUrl = '/.netlify/functions/get-products';

            fetch(apiUrl)
                .then(response => {
                    if (!response.ok) throw new Error(`Network response was not ok: ${response.statusText}`);
                    return response.json();
                })
                .then(products => {
                    if (loadingMessage) loadingMessage.style.display = 'none';
                    
                    if (products && products.length > 0) {
                        products.forEach(product => {
                            const card = document.createElement('div');
                            card.className = 'product-card';
                            const name = product.name ? product.name.replace(/</g, "&lt;") : 'Unnamed Product';
                            const description = product.description ? product.description.replace(/</g, "&lt;") : 'No description available.';
                            const imageUrl = product.image_url || 'images/placeholder-story.jpg';
                            card.innerHTML = `
                                <div class="product-image"><img src="${imageUrl}" alt="${name}"></div>
                                <div class="product-info">
                                    <h3>${name}</h3>
                                    <p style="color: var(--text-light); font-size: 1rem; line-height: 1.5;">${description}</p>
                                </div>`;
                            productGrid.appendChild(card);
                        });
                    } else {
                        productGrid.innerHTML = '<p>No products are currently available. Please check back later.</p>';
                    }
                })
                .catch(error => {
                    console.error('Error fetching products:', error);
                    if(loadingMessage) loadingMessage.style.display = 'none';
                    productGrid.innerHTML = '<p style="color: red;">Sorry, we couldn\'t load our products at this time.</p>';
                })
                .finally(() => {
                    // --- 2. SETUP SCROLL LOGIC (AFTER FETCH) ---
                    // Now that all sections are in the DOM, set up the observers and dots
                    setupScrollFeatures();
                });

            // --- 3. SCROLL FEATURES SETUP FUNCTION ---
            function setupScrollFeatures() {
                const sections = document.querySelectorAll('.product-screen');
                const scrollIndicator = document.querySelector('.scroll-indicator');
                
                // Clear existing dots and rebuild them dynamically
                scrollIndicator.innerHTML = '';
                sections.forEach((_, index) => {
                    const dot = document.createElement('div');
                    dot.className = 'dot';
                    dot.onclick = () => scrollToSection(index);
                    scrollIndicator.appendChild(dot);
                });

                const dots = document.querySelectorAll('.dot');
                if(dots.length > 0) dots[0].classList.add('active');
                
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            // Animate glass-card if it exists
                            const glassCard = entry.target.querySelector('.glass-card');
                            if(glassCard) glassCard.classList.add('visible');

                            // Update active dot
                            const index = Array.from(sections).indexOf(entry.target);
                            dots.forEach(d => d.classList.remove('active'));
                            if (dots[index]) dots[index].classList.add('active');
                        }
                    });
                }, { threshold: 0.5 });

                sections.forEach(section => observer.observe(section));
            }
        });

        function scrollToSection(index) {
            const sections = document.querySelectorAll('.product-screen');
            if (sections[index]) {
                sections[index].scrollIntoView({ behavior: 'smooth' });
            }
        }
    </script>
</body>
</html>